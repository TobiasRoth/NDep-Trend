---
title: No sign of recovery 
preprint: false
author: 
  - name: Tobias Roth
    affiliation: 1, 2
    corresponding: true
    email: t.roth@unibas.ch
  - name: Lukas Kohli
    affiliation: 2
affiliation:
  - code: 1
    address: Zoological Institute, University of Basel, Basel, Switzerland
  - code: 2
    address: Hintermann  Weber AG, Austrasse 2a, 4153 Reinach, Switzerland
abstract: >
  Nitrogen (N) deposition is a major threat to biodiversity of many habitats. The recent intro- duction of cleaner technologies in Switzerland has let to reductions in the emissions of nitro- gen oxides, with affiliated decrease in N-deposition. We infered different drivers of community change (i.e. Nitrogen deposition, climate warming, land-use change) in Swiss mountain hay meadows. The data were obtained from the Swiss biodiversity monitoring.
  Species gain and losses were best explainde by differences in Ellenberg value for temperature suggesting that climate warming was the most important driver of community change in Mountain hay meadows. 
  
header-includes: >
  \usepackage{lipsum}
bibliography: Bibliography.bib
output: 
  rticles::peerj_article:
    base_format: bookdown::pdf_document2 
---

```{r settings, echo = FALSE, message=FALSE, cache=FALSE}
source("R/Settings.R")
```


# Introduction {-}
Nitrogen (N) deposition is a major threat to biodiversity. The recent introduction of cleaner technologies has let to reductions in the emissions of nitrogen oxides, with affiliated decrease in N-deposition in many parts of Europe. However, it is an open question whether and how fast the reduction in N deposition rates will lead to the recovey of extant plant communities.

One useful approach to understanding biodiversity change is through estimates of biodiversity turnover reflecting both immigration and extinction, often in a closed range of values (Hillebrand_et_al-2018.pdf).

Here we infered mountain hay meadows in Switzerland. Explain why mountain hay meadows are important. Also explain other threats to mountain hay meadows (climate change, land-use change). 
 


# Materials & Methods {-}

## Monitoring data {-}
- Selection of sample sites based on 1366 K_Standort.csv column "E23_1366".
- Three surveys 2003-2007, 2008-2012 and 2013 - 2017.

## Plant traits {-}
Functional traits:

- SLA: specific leaf area
- CH: canopy height
- SM: Seed mass

Ellenberg indicator values:

- L: light
- N: Nutrient contentent
- T: Temperature
- F: Huminity

Community measures:

- Species richness: number of recorded species per $10m^2$.
- Spatial turnover (beta-diversity): Average turnover between all pair-wise combinations of study plots.
- gamma diversity: Total number of species recorded in all study plots.

### Community measures {-}

The temporal turnover (i.e. species exchange ratio sensu @Hillebrand2018) is the proportion of species that differ between two time points calculated as

$\text{Spatial turnover} = \frac{\text{Species gained} + \text{Species lost}}{\text{Total species observed in both timepoints}}$.



## Statistical analyses {-}
Environmental variables were standardized.


```{r helpfunctions}
# Help functions to get posterior samples
getposterior <- function(x) {
  list( 
    `EL = 2` = plogis(simdat[x,1] + Xsd * simdat[x,2] - simdat[x,3] -  Xsd * simdat[x,4]),
    `EL = 4` = plogis(simdat[x,1] + Xsd * simdat[x,2] + simdat[x,3] +  Xsd * simdat[x,4]))
}

compileres <- function(EL) {
  tt <- map(1:length(X), function(s) map(post, paste(EL)) %>% map_dbl(s))
  tibble(mean = map_dbl(tt, mean),
         low = map_dbl(tt, quantile, probs = 0.025),
         high = map_dbl(tt, quantile, probs = 0.975),
         X = X,
         value = paste(EL)
  )
}
```

# Results {-}

```{r communitytrendscalc}
res <- tibble(Measures = c("Alpha-diversity", "Beta-diversity", "Temperature value", "Huminity value", "Nutrients value", "Light value"),
              'Period 1' = NA,
              'Period 2' = NA,
              'Period 3' = NA,
              'Trend' = NA,
              '5%' = NA,
              '95%' = NA,
              'Prob. for Trend' = NA)

# Alpha diversity
res[1, c("Period 1", "Period 2", "Period 3")] <- tapply(surv$SR, surv$Visit, mean)
load("Modelfit/SR-trend.RData")
res[1, "Trend"] <- fixef(mod)["yr"]
res[1, c('5%', '95%')] <- posterior_interval(mod, pars = "yr")
res[1, 'Prob. for Trend'] <- mean(as.data.frame(mod, pars = "yr")$yr > 0)

# Beta diversity
getbeta <- function(x) {
  tmp <- simba::sim(pl %>% filter(Visit == x) %>% dplyr::select(aID_STAO, aID_SP, Occ), 
                    method = "simpson", listin = TRUE, listout = TRUE)
  mean(tmp$simpson)
}
res[2, c("Period 1", "Period 2", "Period 3")] <- lapply(1:3, getbeta)

# Mean community index
res[3, c("Period 1", "Period 2", "Period 3")] <- tapply(surv$T, surv$Visit, mean)
load("Modelfit/T-trend.RData")
res[3, "Trend"] <- fixef(mod)["yr"]
res[3, c('5%', '95%')] <- posterior_interval(mod, pars = "yr")
res[3, 'Prob. for Trend'] <- mean(as.data.frame(mod, pars = "yr")$yr > 0)

res[4, c("Period 1", "Period 2", "Period 3")] <- tapply(surv$F, surv$Visit, mean)
load("Modelfit/F-trend.RData")
res[4, "Trend"] <- fixef(mod)["yr"]
res[4, c('5%', '95%')] <- posterior_interval(mod, pars = "yr")
res[4, 'Prob. for Trend'] <- mean(as.data.frame(mod, pars = "yr")$yr > 0)

res[5, c("Period 1", "Period 2", "Period 3")] <- tapply(surv$N, surv$Visit, mean)
load("Modelfit/N-trend.RData")
res[5, "Trend"] <- fixef(mod)["yr"]
res[5, c('5%', '95%')] <- posterior_interval(mod, pars = "yr")
res[5, 'Prob. for Trend'] <- mean(as.data.frame(mod, pars = "yr")$yr > 0)

res[6, c("Period 1", "Period 2", "Period 3")] <- tapply(surv$L, surv$Visit, mean)
load("Modelfit/L-trend.RData")
res[6, "Trend"] <- fixef(mod)["yr"]
res[6, c('5%', '95%')] <- posterior_interval(mod, pars = "yr")
res[6, 'Prob. for Trend'] <- mean(as.data.frame(mod, pars = "yr")$yr > 0)
```

```{r communitytrends, echo=FALSE}
options(knitr.kable.NA = '')
kable(res, align = c("l", rep("r", 7)), digits = 2,  booktabs = T, col.names = c("Measures", "Period 1", "Period 2", "Period 3", "Trend", "5%", "95%", "Prob. for trend"), caption = "Average measures of community structure for the three sampling periods (period 1: 2003-2007; period 2: 2008-2012; period: 2013-2017). The temporal trends are given as  change per 10 years and were estimated from linear mixed models with normal distribution (except for alpha-diversity with Poisson distribution and a log-link function) with site-ID as random intercept and slope effect. The measure of precision for the temporal trend is given as the 5\\% and 95\\% quantiles of the marginal posterior distribution. Finally, the probability that the linear trend is $> 0$ is given. Linear mixed models were not applicable for beta-diversity because measures for beta-diversity were not available for the single sites.")
```

The different measures of total community structure suggested that plant communities in mountain hay meadows were rather stable between 2003 and 2017 and did not show a consistent increase or decrease over time (Table \@ref(tab:communitytrends)): for each of the three 5-year survey periods the averages of alpha- and beta-diversity and the average Ellenberg values for temperature, huminity, nutrients and light did not vary much among the three sampling periods and the estimated trends were rather small. Except for average Ellenberg value for temperature, the 90% credible-interval of the temporal trend contained zero. The results from the linear mixed models suggest that a linear temporal change was most likely for the community mean of the Ellenberg value for temperature (probability for an increase: `r 
res %>% filter(Measures == "Temperature value") %>% pull("Prob. for Trend")`), followed by the community mean of the Ellenberg light value (probaility for a decrease: `r 1 - res %>% filter(Measures == "Light value") %>% pull("Prob. for Trend")`) and it was least likely for the alpha-diversity (probability for an increase: `r res %>% filter(Measures == "Alpha-diversity") %>% pull("Prob. for Trend")`). The chance that the community mean of the nutrient value decreased between 2003 and 2017 was `r 1- res %>% filter(Measures == "Nutrients value") %>% pull("Prob. for Trend")`. 

```{r turnover}
# Load Binomial-GLMM for turnover
load("Modelfit/turnover-trend.RData")

# Compile res for table
res <- tibble()
tparams <- c("Temperature", "Precipitation", "NTOT", "Inclination")
res <- tibble(
  Gradient = c("Annual mean temperature", "Annual mean precipitation", "Nitrogen deposition", "Inclination"),
  Estimate = fixef(mod)[tparams],
  `5%` = posterior_interval(mod, pars = tparams)[,1],
  `95%` = posterior_interval(mod, pars = tparams)[,2])

# 90% CrI for period effect
tmp <-  posterior_interval(mod, pars = "period")
CrI <- paste0(round(tmp[1,1], 2), " - ", round(tmp[1,2], 2))
```

```{r turnovertab, echo=FALSE}
options(knitr.kable.NA = '')
kable(res, align = c("l", rep("r", 3)), digits = 2,  booktabs = T, col.names = c("Gradient", "Estimate", "5%", "95%"), caption = "Change of species turnover along the four gradients. The slopes along the gradients (estimate) are given as the change per 10 years of the logit-probability of species that differed between two surveys. Estimates and the 5\\% and 95\\% quantiles of the marginal posterior distribution obtained from a Binomial-GLMM with the proportion of species that differed between two surveys as dependent variable and the site gradients and period as predictors and site-ID as random effect.")
```

This temporal stability as inferred from the community measures was, however, in contrast to a rather large observed temporal turnover of species. The average percentage $\pm$ SD of species that differed between the first and second survey at a site was `r mean(100 * sites$change1 / (sites$nochange1 + sites$change1))` $\pm$ `r sd(100 * sites$change1 / (sites$nochange1 + sites$change1))`% and the percentage of species that differ between the second and third survey was `r mean(100 * sites$change2 / (sites$nochange2 + sites$change2))` $\pm$ `r sd(100 * sites$change2 / (sites$nochange2 + sites$change2))`%. Thus, it seemed that the turnover from the first/second survey to the turnover of the second/third survey moderately decreased (90% Credible interval of the change in turnover estimated from the Binomial generalized linear mixed model that also contained site variables: `r CrI`). Variation in species turnover was largest along the Nitrogen deposition gradient with highest species turnover at sites with low Nitrogen deposition (Table \@ref(tab:turnovertab)). The other three gradients were less inportant to explain the variation in species turnover among sites.

```{r difffromrandom}
getres <- function(param, gradient, file) {
  tt <- tibble()
  load(paste0("Communitysim/", file))
  tres$StandEf <- tres$meanreal - tres$mean
  mod <- stan_glm(StandEf ~ Sitemeasure, data = tres , family = gaussian(), cores = 4)
  tt[1, "Ellenberg value"] <- param
  tt[1, "Gradient"] <- gradient
  tt[1, "Estimate"] <- coef(mod)[1]
  tmp <- posterior_interval(mod, pars = "(Intercept)")[1,] %>% as.vector()
  tt[1, "5%"] <- tmp[1] 
  tt[1, "90%"] <- tmp[2] 
  tt[1, "Estimate_Slope"] <- coef(mod)[2]
  tmp <- posterior_interval(mod, pars = "Sitemeasure")[1,] %>% as.vector()
  tt[1, "5%_Slope"] <- tmp[1] 
  tt[1, "90%_Slope"] <- tmp[2] 
  tt
}

res <- getres("Temperature", "Annual mean temperature", "lossT.RData")
res <- rbind(res,  z <- getres("Humidity", "Annual mean precipitation", "lossF.RData"))
res <- rbind(res,  getres("Nutrients", "Nitrogen deposition", "lossN.RData"))
res <- rbind(res,  getres("Light", "Inclination", "lossL.RData"))
res <- rbind(res, getres("Temperature", "Annual mean temperature", "gainT.RData"))
res <- rbind(res,  z <- getres("Humidity", "Annual mean precipitation", "gainF.RData"))
res <- rbind(res,  getres("Nutrients", "Nitrogen deposition", "gainN.RData"))
res <- rbind(res,  getres("Light", "Inclination", "gainL.RData"))
```

```{r difffromrandomtab}
kable(res, align = c("l", "l", rep("c", 6)), digits = 3,  booktabs = T, col.names = c("Ellenberg value", "Gradient", "Estimate", "5%", "90%", "Estimate", "5%", "90%"), caption = "Difference in the average Ellenberg value of species that (a) disappeared from site or (b) newly colonized a site compared to the same number of species that were randomly selected from all species recorded at a site. Shown are the results from linear model with the difference between disappeard/colonized species and random species as dependend variable and the sitemeasure (gradient) as predictor variable.") %>% 
  kable_styling() %>% 
  group_rows("(a) Plants that disappeard from a site", 1, 4, bold = F, italic = T) %>%
  group_rows("(b) Plants that newly colonized a site", 5, 8, bold = F, italic = T) %>%
  add_header_above(c(" " = 2, "Difference from random" = 3, "Change along gradient" = 3))
```

High species turnover at a site is the result of species that disappeared from the site and species that newly colonized the site. To better understand the factors that drive these changes we are particularly interested whether the species that disappeared or colonized the sites differed in Ellenberg values compared to what would be expected if the same number of species randomly disappeared or colonized the sites (i.e. random disappearance and random colonization) and whether there is a change along the gradients. It seems that the Ellenberg values of newly colonizing species differened more from random colonization than the Ellenberg values of disappearing species from random disappearance (Table \@ref(tab:difffromrandomtab)). For colonizing species, we found the largest differences from random colonization in the Ellenberg value for nutrients: at sites with nitrogen deposition of 10 kg ha$^{-1}$ yr$^{-1}$ the newly colonizing species had in average a lower Ellenberg value for nutrients than species under random disappearance (column "Difference from random" in Table \@ref(tab:difffromrandomtab)), but this differences between colonizing species and random colonization decreases with increasing N deposition (column "Change along gradient" in Table \@ref(tab:difffromrandomtab)). 

While colonizing species had higher temperature values compared to what we would be expected under random colonization, the differences between colonizing species and random colonization was about four times smaller compared to the Ellenberg value for nutrients. Nevertheless, the variation in Ellenberg value for temperature was impportant to explain the total species turnover. This is because, disappearing species tend to have lower temperature value than randomly dieappearing species leading to an overall replacement of species with lower temperature value with species with higher temperature values. This was not the case for the Ellenberg value for nutrients: it was also species with lower nutrients values that tended to be more likely to disappear than randomly disappearing species (Table \@ref(tab:difffromrandomtab)). See also Appendix A were we present detailed results for the comparision between colonizating and disappearing species with randomly selected species. 



```{r neff, fig.cap="Colonization (a) and local survival (b) of oligotrophic (Ellenberg N = 2; red line) and eutrophic (Ellengerg N = 4) species along the N deposition gradient. Given are means and 95\\%-Credible Intervals from logistic linear mixed models."}
nsim <- 100
X <- 5:30
Xsd <- (X - 10) / 10

library(sp)
library(rgeos)

# Help functions to get posterior samples
getposterior <- function(x) {
  EL1 <- plogis(simdat[x,1] + Xsd * simdat[x,2] + 2 * simdat[x,3] +  Xsd * 2 * simdat[x,4])
  EL2 <- plogis(simdat[x,1] + Xsd * simdat[x,2] + 4 * simdat[x,3] +  Xsd * 4 * simdat[x,4])
  ll1 <- Lines(list(Line(matrix(c(X, EL1), nc = 2, byrow = F))), ID = "1")
  ll2 <- Lines(list(Line(matrix(c(X, EL2), nc = 2, byrow = F))), ID = "1")
  sl1 <- SpatialLines(list(ll1), proj4string = CRS("+init=epsg:4269"))
  sl2 <- SpatialLines(list(ll2), proj4string = CRS("+init=epsg:4269"))
  tCL <- NA
  try(tCL <- gIntersection(sl1, sl2, byid = TRUE)@coords[1, "x"])
  list( 
    `EL = 2` = EL1,
    `EL = 4` = EL2,
    CL = tCL)
}

compileres <- function(EL) {
  tt <- map(1:length(X), function(s) map(post, paste(EL)) %>% map_dbl(s))
  tibble(mean = map_dbl(tt, mean),
         low = map_dbl(tt, quantile, probs = 0.025),
         high = map_dbl(tt, quantile, probs = 0.975),
         X = X,
         value = paste(EL)
  )
}

# Colonization
load("Modelfit/colonization-N.RData")
simdat <- arm::sim(mod, nsim)@fixef
post <- map(1:nsim, getposterior)
res <- rbind(compileres("EL = 2"), compileres("EL = 4"))
CLs <- map_dbl(post, "CL")
p1 <- ggplot(res, aes(x = X, y = mean, colour = value, shape = value)) +
  geom_ribbon(aes(ymin = low, ymax = high), fill = "black", col = "white", alpha = 0.2) +
  geom_line() +
    labs(title = "(a) Colonization", 
         y = "Colonization probability", 
         x = "Nitrogen deposition") +
  geom_vline(xintercept = mean(CLs, na.rm = TRUE)) +
  geom_vline(xintercept = quantile(CLs, probs = 0.05, na.rm = TRUE), lty = 2) +
  geom_vline(xintercept = quantile(CLs, probs = 0.95, na.rm = TRUE), lty = 2)


# Local survival
load("Modelfit/localsurvival-N.RData")
simdat <- arm::sim(mod, nsim)@fixef
post <- map(1:nsim, getposterior)
res <- rbind(compileres("EL = 2"), compileres("EL = 4"))
CLs <- map_dbl(post, "CL") 
p2 <- ggplot(res, aes(x = X, y = mean, colour = value, shape = value)) +
  geom_ribbon(aes(ymin = low, ymax = high), fill = "black", col = "white", alpha = 0.2) +
  geom_line() +
  labs(title = "(b) Local survival", 
       y = "Local survival probability", 
       x = "Nitrogen deposition")+
  geom_vline(xintercept = mean(CLs, na.rm = TRUE)) +
  geom_vline(xintercept = quantile(CLs, probs = 0.05, na.rm = TRUE), lty = 2) +
  geom_vline(xintercept = quantile(CLs, probs = 0.95, na.rm = TRUE), lty = 2)
multiplot(p1, p2, cols = 2)
```




# Discussion {-}
- Any empty space that could be caused by any disturbance that let to the local disappearance of species is likely to be fiellied by eutrophic species. Disturbance depends on the site, while colonization depends on species characteristics.

- The rather large spatial turnover might be partly explained by species that remained undetected in one of the surveys, but it might also be the result of species that newly colonized sites (species gains) and species that truely disappeared from sites (species losses).

- Altough N deposition considerabely declinded between 2005 and 2015, we could not detect major shifts in plant community structure during the same time period. 

- Eutrophic species have rather high local survival across the entire deposition gradient, while oligotrophic species have much reduced local survival at high N deposition. This suggests that it takes much more time to replace eutrophic by oligotrophic species than replacing oligotrophic by eutrophic species. 

- Our data on colonization and local survival (i.e. temporal variation) confirm the empirical critical loads that we infered from anlysing spatial co-variation of N deposition and species richness.  

- Local survival is higher for low temperature plants --> This could explain the decrease in cumminity change along elevation. This could also explain the differences at mount summets were space was empty in the beginning.

- Climatic effects are more likely to be reversed thant effects due to fertilization.


### Space for time substitution
Often observational studies infer the change of plant diversity along a gradient of N deposi- tion. Thus, they infer how the spatial variation in species richness is related to N deposition and assume that this spatial variation in species richness arose because over time some areas lost more species than others because they chronically experienced higher N deposition. Alt- hough there is evidence supporting the use of such a 'space for time substitution' for detecting the effects of N deposition on plant diversity (Stevens et al. 2010), they can not replace stud- ies that relate temporal patterns in species with N deposition (De Schrijver et al. 2011). While recovery of acidified surface waters has been well investigated (De Vries et al. 2015), there are only a limited number of studies inferring temporal trends of plant species diversity relat- ed to varying amounts of N-deposition. Storkey et al. (2015) demonstrated a positive response of biodiversity to reducing N addition from either atmospheric pollution or fertilizers in the Park Grass Experiment: «The proportion of legumes, species richness and diversity increased across the experiment between 1991 and 2012 as N-deposition declined». For forest floor vegetation in permanent plots across Europe the exceedance of critical loads of N over a peri- od from 9 to 42 years had negative effects on the cover of oligotrophic plant species, i.e spe- cies that prefer nutrient-poor soils, although species richness remained constant (Dirnböck et al. 2014). Another example of recovery in eutrophicated habitats gives the recovery of species richness in previously fertilized plots (Clark and Tilman 2008). In this study, the recorded recovery in species richness within one or two decade was likely due to the species rich vege- tation surrounding the experimental plots, from where immigration was easily feasible.

> Hier sagen, dass der CRL identisch wie der CRL von räumlichen Zusammenhängen ist.




# Conclusions {-}
xxx

# Acknowledgements {-}
We thank the dedicated and qualified botanists who conducted fieldwork. The Swiss Federal Office for the Environment (FOEN) kindly provided biodiversity monitoring data and topographic data. This work was supported by the FOEN, the Swiss National Science Foundation (grant no. 31003A_156294), the Swiss Association Pro Petite Camargue Alsacienne, the Fondation de bienfaisance Jeanne Lovioz, and the MAVA Foundation.

# References {-}




```{r}
# The MS was build with the following R sesstion:
writeLines(capture.output(sessionInfo()), "sessionInfo.txt")
```

